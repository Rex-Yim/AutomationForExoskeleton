# Robotic Exoskeleton Control System for Load Transportation

## ğŸ“– Executive Summary

This project implements a software-centric enhancement module for a lower-limb robotic exoskeleton designed to assist workers in heavy load transportation tasks (>20 kg).

The system provides **real-time locomotion intent detection** and **joint kinematics estimation** using a multi-sensor fusion approach. It runs entirely in MATLAB and generates stable control commands (e.g., switching between *Standing* and *Walking* assistance modes) based on Inertial Measurement Unit (IMU) data.

### Key Objectives
1.  **Sensor Fusion:** Robust estimation of hip flexion angles using Kalman Filtering on IMU data.
2.  **Intent Detection:** Real-time classification of locomotion modes using Support Vector Machines (SVM).
3.  **State Management:** A Finite State Machine (FSM) with hysteresis to prevent rapid switching and ensure smooth actuator control.
4.  **Modularity:** A layered architecture separating data acquisition, feature extraction, and control logic.

---

## ğŸ—ï¸ System Architecture

The system processes data in a sequential pipeline operating at **100 Hz**.

### Data Flow Diagram

```mermaid
graph TD
    IMU[IMU Sensors] --> Feat[Feature Extraction]
    IMU --> Fusion[Sensor Fusion]
    Feat --> SVM[SVM Classifier]
    SVM --> Label[Predicted Label]
    Fusion --> Angles[Joint Angles]
    Label --> Est[State Estimator]
    Angles --> Est
    Est --> Cmd[Control Command]
    Cmd --> Torque[Torque Profile]
    Torque --> Act[Exoskeleton Actuators]
```

### Core Pipeline Components

| Component | File Path | Description |
| :--- | :--- | :--- |
| **A. Configuration** | `config/ExoConfig.m` | Centralized parameters for FS (100Hz), Window Size (1.0s), and Thresholds. |
| **B. Fusion** | `src/fusion/FusionKalman.m` | Uses `imufilter` (Sensor Fusion Toolbox) to estimate orientation and hip flexion angles. |
| **C. Features** | `src/features/Features.m` | Extracts a **5-dimensional feature vector**: <br>1. Mean Acceleration<br>2. Variance of Acceleration<br>3. Mean Gyroscope<br>4. Variance of Gyroscope<br>5. Dominant Frequency (FFT) |
| **D. Classifier** | `results/Binary_SVM_Model.mat` | Pre-trained RBF-kernel SVM model for binary classification (Stand vs. Walk). *(Saved to `results/` by default in ExoConfig)* |
| **E. Control** | `src/classification/RealtimeFsm.m` | Implements **asymmetric hysteresis** to stabilize control commands:<br>â€¢ *Entry (Standâ†’Walk):* 3 consecutive predictions<br>â€¢ *Exit (Walkâ†’Stand):* 5 consecutive predictions |

---

## âš™ï¸ Installation and Prerequisites

### Software Requirements
*   **MATLAB R2020b** or later
*   **Required Toolboxes:**
    *   Statistics and Machine Learning Toolbox (for SVM)
    *   Sensor Fusion and Tracking Toolbox (for `imufilter`)
    *   Signal Processing Toolbox (for FFT)

### Setup
1.  Clone this repository.
2.  Open MATLAB and navigate to the project root.
3.  Run the startup script to add all subfolders to the MATLAB path:
    ```matlab
    >> startup
    ```

---

## ğŸ“Š Data Preparation

The system is designed to work with public datasets for training and validation.

### Supported Datasets

1.  **USC-HAD** (Training)
    *   Place raw `.mat` files in: `data/public/USC-HAD/USC-HAD_raw/`
    *   Run `LoadUSCHAD` to normalize the data.

2.  **HuGaDB** (Validation)
    *   Place raw `.txt` files in: `data/public/HuGaDB/HuGaDB_v2_raw/`

### Training the Model

> **âš ï¸ Important:** The repository may not contain the trained `.mat` model file. You must train it before running simulations.

Run the following command in the MATLAB console:

```matlab
>> TrainSvmBinary
```

*This script loads USC-HAD data, extracts the 5 features, trains an RBF SVM, and saves the model to `results/Binary_SVM_Model.mat`.*

---

## â–¶ï¸ Usage

### A. Run Real-Time Simulation
To simulate the full pipeline using recorded data:

```matlab
>> RunExoskeletonPipeline
```

**Output:** Generates a plot in `results/realtime_pipeline_output.png` displaying:
*   Estimated Hip Flexion Angle (Kalman)
*   Control Command (FSM Output)
*   Ground Truth Comparison

### B. Performance Evaluation
To calculate specific metrics (Accuracy, Precision, Recall, Specificity) against ground truth:

```matlab
>> TestPipelinePerformance
```

*Current Benchmark: ~85% Accuracy with a 150ms predictive horizon.*

---

## ğŸ“‚ File Organization

```text
AutomationForExoskeleton/
â”œâ”€â”€ config/             # System configuration (ExoConfig.m)
â”œâ”€â”€ data/               # Datasets (USC-HAD, HuGaDB, raw CSVs)
â”œâ”€â”€ docs/               # Reports and Design Documents
â”œâ”€â”€ models/             # Folder for potential model storage
â”œâ”€â”€ results/            # Pipeline outputs & Active SVM Model
â”œâ”€â”€ scripts/            # Main execution scripts
â”‚   â”œâ”€â”€ RunExoskeletonPipeline.m   # Main simulation entry point
â”‚   â”œâ”€â”€ TrainSvmBinary.m           # Model training script
â”‚   â”œâ”€â”€ TestPipelinePerformance.m  # Accuracy/Recall testing
â”‚   â””â”€â”€ utils/                     # Helper tools
â”œâ”€â”€ src/                # Source code libraries
â”‚   â”œâ”€â”€ acquisition/    # Data import logic
â”‚   â”œâ”€â”€ classification/ # SVM prediction and FSM logic
â”‚   â”œâ”€â”€ features/       # FFT and statistical feature extraction
â”‚   â””â”€â”€ fusion/         # Kalman filter implementation
â””â”€â”€ tests/              # Unit tests
```

---

## ğŸ¤ Acknowledgments

*   **ExoTechHK Limited** for collaboration and prototype access.
*   **HKSTP** for incubation support.
*   **Datasets provided by:**
    1.  Chereshnev et al. (HuGaDB)
    2.  Zhang et al. (USC-HAD)